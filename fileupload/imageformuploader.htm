<!DOCTYPE html><html><head><title>Image uploader</title>
<style>
.progress { position:relative; width:400px; border: 1px solid #ddd; padding: 1px; border-radius: 3px; }
.bar { background-color: #B4F5B4; width:0%; height:20px; border-radius: 3px; }
.percent { position:absolute; display:inline-block; top:3px; left:48%; }
</style>
<link rel="stylesheet" href="stylesheets/style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="http://malsup.github.com/jquery.form.js"></script>

</head>
<body>
<h3>caMicroscope Image Loader</h3>
<form id="uploadme" action="/submitData" method="post" enctype="multipart/form-data">
<span class="label">Image Id:</span>
<input type="text" name="case_id" label="Image ID: "><br><span class="label">Upload File:</span>
<input type="file" name="upload_image"><br>
<input id="submitButton" type="submit"></form><br>
<div class="progress">
    <div class="bar"></div >
    <div class="percent">0%</div >
</div>
<div id="status"></div><br>
<h3 id="estatus"></h3>
<h3 id="back"></h3>
<script>
$(document).ready(function(){
        var bar = $('.bar');
        var percent = $('.percent');
        var status = $('#status');

        $('#uploadme').ajaxForm({
                url: '/submitData',
                dataType : 'json',
                beforeSend: function() {
                        document.getElementById("estatus").innerHTML = "uploading...";
                        status.empty();
                        var percentVal = '0%';
                        bar.width(percentVal);
                        percent.html(percentVal);
                },
                uploadProgress: function(event, position, total, percentComplete) {
                        var percentVal = percentComplete + '%';
                        bar.width(percentVal);
                        percent.html(percentVal);
                },
                complete: function(xhr) {
                        //status.html(xhr.responseText);
                },
                error: function(response) {
                                console.log(response.status);
                                console.log("Call Tahsin...");
                                document.getElementById("estatus").innerHTML = "Problem with uploading... Try again or go to home page.";
				var myItem = "<button type=\"button\" onclick=\"location.href = \'http://" + String(location.hostname) + "'\" >Home Page</button>";
				console.log(myItem);
                                document.getElementById("back").innerHTML = myItem;
                                      },
                success: function(response) {
                                console.log(response.status);
				var myItem = "<button type=\"button\" onclick=\"location.href = \'http://" + String(location.hostname) + "'\" >Home Page</button>";
				console.log(myItem);
                                document.getElementById("estatus").innerHTML = "uploaded...";
                                document.getElementById("back").innerHTML = myItem;
                                        }
        });
});
</script>
</body></html>
